<!doctype html>
<html itemscope="" itemtype="http://schema.org/SearchResultsPage" lang="en">

<head>
  <meta content="origin" name="referrer">
  <title>graph analyzer</title>
  <script src="../build/g6.js"></script>
  <script src="../build/plugin.template.maxSpanningForest.js"></script>
  <script src="../build/plugin.behaviour.analysis.js"></script>
  <script src="../build/plugin.tool.mapper.js"></script>
  <script src="../build/plugin.tool.fisheye.js"></script>
  <script src="../build/plugin.util.extractSubgraph.js"></script>
  <!-- <script src="../build/plugin.util.maxSpanningForest.js"></script> -->
  <script src="../build/plugin.tool.highlightSubgraph.js"></script>
  <script src="../build/plugin.edge.quadraticCurve.js"></script>
  <script src="../build/plugin.tool.minimap.js"></script>
  <script src="../build/plugin.tool.textDisplay.js"></script>
  <script src="./assets/jquery-3.2.1.min.js"></script>
  <style>
    ul,
    li {
      margin: 0;
      padding: 0;
    }

    #myMenu {
      color: #777;
      list-style: none;
      width: 150px;
      border: 1px solid #ccc;
      border-bottom: none;
      position: absolute;
      display: none;
      background-color: #fff
    }

    #myMenu li {
      padding: 5px 10px;
      cursor: pointer;
    }

    #myMenu li:hover {
      color: #6af
    }

    #menu_detail {
      color: #6af;
      border-top: 1px solid #ccc;
      border-bottom: 1px solid #ccc;
    }

  </style>

</head>

<body>
  <div id='mountNode'></div>
  <div id='legend'></div>
  <ul id="myMenu">
    <li id="menu_sources">来源</li>
    <li id="menu_targets">去向</li>
    <li id="menu_both">来源去向</li>
    <li id='menu_detail'> 查看单页分析详情</li>
  </ul>
  <div id="minimap" style="border: 1px solid #999; position: absolute; top: 0px;"></div>
  <script>
    var graph = null;
    var clickOnNode = null;

    $.getJSON('./assets/data/view-test.json', data => {
      //the plugins
      const Mapper = G6.Plugins['tool.mapper'];
      const MaxSpanningForestPlugin = G6.Plugins['template.maxSpanningForest'];
      const Highlighter = G6.Plugins['tool.highlightSubgraph'];
      const FisheyePlugin = G6.Plugins['tool.fisheye'];
      //the instances of plugins
      const maxSpanningForest = new MaxSpanningForestPlugin({
        layoutCfg: {
          max_iteration: 600,
          kg: 10,
          prev_overlapping: true,
          onLayoutComplete: function () {
            const minimap = document.getElementById('minimap');
            const legend = document.getElementById('legend');
            if (minimap !== undefined) minimap.style.display = 'block';
            if (legend !== undefined) legend.style.display = 'block';
          }
        }
      });
      const fisheye = new FisheyePlugin({
        radius: 200
      });
      const nodeSizeMapper = new Mapper('node', 'userview', 'size', [20, 50], {
        legendCfg: {
          scale: 0.5
        }
      });
      const edgeSizeMapper = new Mapper('edge', 'userview', 'size', [2, 20], {
        legendCfg: null
      });
      const nodeColorMapper = new Mapper('node', 'stayTime', 'color', ['#BAE7FF', '#1890FF', '#0050B3'], {
        legendCfg: {
          scale: 0.5
        }
      });
      const minimapPlugin = new G6.Plugins['tool.minimap']({
        container: 'minimap',
        width: 180,
        height: 120
      });
      const highlighter = new Highlighter();
      const textDisplay = new G6.Plugins['tool.textDisplay']();

      const Util = G6.Util;

      graph = new G6.Graph({
        id: 'mountNode', // dom id
        fitView: 'cc',
        plugins: [
<<<<<<< Updated upstream
          maxSpanningForest, nodeSizeMapper, nodeColorMapper, edgeSizeMapper, minimapPlugin, highlighter,
          textDisplay, fisheye
=======
          new Plugin({
            max_iteration: 600,
            kg: 10,
            prev_overlapping: true
          }),
          nodeSizeMapper, nodeColorMapper, edgeSizeMapper, minimapPlugin,
          new FisheyePlugin({
            radius: 200
          }), highlighter, textDisplay
>>>>>>> Stashed changes
        ],
        minZoom: 0,
        modes: {
          default: ['panCanvas', 'wheelZoom']
        },
        height: 1000,
      });
      graph.read(data);
      // Util.maxSpanningForest(graph, {});

      const minimap = document.getElementById('minimap');
      const legend = document.getElementById('legend');
      if (minimap !== undefined) minimap.style.display = 'none';
      if (legend !== undefined) legend.style.display = 'none';
    });

<<<<<<< Updated upstream
=======

    function clickMenu(ev) {
      let type = 'in';
      switch (ev.id) {
        case 'menu_sources':
          type = 'in';
          break;
        case 'menu_targets':
          type = 'out';
          break;
        case 'menu_both':
          type = 'bi';
          break;
        default:
          break;
      }
      const {
        re_nodes,
        re_edges
      } = Util.extract(graph, type, 1, [clickOnNode]);
      graph.highlightSubgraph({
        re_nodes,
        re_edges
      });
      // show the hided edge, which is not tree edge and it is in the es
      // and the source and targert of the edge are both visible
      const edges = graph.getEdges();
      Util.each(edges, edge => {
        if (!edge.isVisible() && !edge.getModel().isTreeEdge &&
          edge.getSource().isVisible() && edge.getTarget().isVisible()) {
          Util.each(re_edges, e => {
            if (edge.id === e.id) {
              edge.show();
            }
          });
        }
      });

      const menu = document.getElementById('myMenu');
      menu.style.display = 'none';
      var canvas = document.getElementsByTagName("canvas")[0];
    }
>>>>>>> Stashed changes
  </script>

</body>
