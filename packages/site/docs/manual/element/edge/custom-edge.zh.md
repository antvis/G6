---
title: è‡ªå®šä¹‰è¾¹
order: 10
---

G6 æä¾›äº†å¤šç§[å†…ç½®è¾¹](/manual/element/edge/build-in/base-edge)ç±»å‹ï¼Œä¾‹å¦‚ç›´çº¿è¾¹ã€æŠ˜çº¿è¾¹ã€è´å¡å°”æ›²çº¿è¾¹ç­‰ã€‚ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦åˆ›å»ºå…·æœ‰ç‰¹å®šæ ·å¼æˆ–äº¤äº’æ•ˆæœçš„è‡ªå®šä¹‰è¾¹ã€‚

## å¼€å§‹ä¹‹å‰ï¼šäº†è§£è¾¹çš„åŸºæœ¬æ„æˆ

åœ¨ G6 ä¸­ï¼Œä¸€æ¡å®Œæ•´çš„è¾¹é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

<image width="300" src="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*YKN7TasqOh4AAAAAAAAAAAAADmJ7AQ/original" />

- `key` ï¼šè¾¹çš„ä¸»å›¾å½¢ï¼Œè¡¨ç¤ºè¾¹çš„ä¸»è¦å½¢çŠ¶ï¼Œä¾‹å¦‚ç›´çº¿ã€æŠ˜çº¿ç­‰ï¼›
- `label` ï¼šæ–‡æœ¬æ ‡ç­¾ï¼Œé€šå¸¸ç”¨äºå±•ç¤ºè¾¹çš„åç§°æˆ–æè¿°ï¼›
- `arrow` ï¼šç®­å¤´ï¼Œç”¨äºè¡¨ç¤ºè¾¹çš„æ–¹å‘ï¼›
- `halo` ï¼šä¸»å›¾å½¢å‘¨å›´å±•ç¤ºçš„å…‰æ™•æ•ˆæœçš„å›¾å½¢ã€‚

:::info{title=è¾¹çš„ä¸»è¦åŠŸèƒ½}
è¾¹åœ¨å›¾ä¸­æ‰¿æ‹…ç€è¿æ¥èŠ‚ç‚¹çš„é‡è¦è§’è‰²ï¼Œä¸ä»…æä¾›è§†è§‰ä¸Šçš„è¿æ¥ï¼Œè¿˜å¯ä»¥é€šè¿‡æ ·å¼å’Œäº¤äº’ä¼ è¾¾å…³ç³»çš„å±æ€§å’ŒçŠ¶æ€ã€‚
:::

## è‡ªå®šä¹‰è¾¹çš„æ–¹å¼ <Badge type="warning">é€‰æ‹©åˆé€‚çš„æ–¹å¼</Badge>

åˆ›å»ºè‡ªå®šä¹‰è¾¹çš„æ–¹å¼ä¸è‡ªå®šä¹‰èŠ‚ç‚¹ç±»ä¼¼ï¼Œä¸»è¦æœ‰ä¸¤ç§é€”å¾„ï¼š

1. ç»§æ‰¿ç°æœ‰è¾¹ç±»å‹ <Badge type="success">æ¨è</Badge>

   è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥é€‰æ‹©ç»§æ‰¿ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š

   - `BaseEdge` - æœ€åŸºç¡€çš„è¾¹ç±»ï¼Œæä¾›è¾¹çš„æ ¸å¿ƒåŠŸèƒ½
   - `Line` - ç›´çº¿è¾¹
   - `Polyline` - æŠ˜çº¿è¾¹
   - `Quadratic` - äºŒæ¬¡è´å¡å°”æ›²çº¿è¾¹
   - `Cubic` - ä¸‰æ¬¡è´å¡å°”æ›²çº¿è¾¹
   - `CubicVertical` - å‚ç›´ä¸‰æ¬¡è´å¡å°”æ›²çº¿è¾¹
   - `CubicHorizontal` - æ°´å¹³ä¸‰æ¬¡è´å¡å°”æ›²çº¿è¾¹

2. åŸºäº G å›¾å½¢ç³»ç»Ÿä»é›¶å¼€å‘ <Badge>é«˜çº§ç”¨æ³•</Badge>

å¦‚æœç°æœ‰è¾¹ç±»å‹éƒ½ä¸æ»¡è¶³éœ€æ±‚ï¼Œä½ å¯ä»¥åŸºäº G çš„åº•å±‚å›¾å½¢ç³»ç»Ÿä»é›¶åˆ›å»ºè¾¹ã€‚ä½ éœ€è¦è‡ªè¡Œå¤„ç†æ‰€æœ‰ç»†èŠ‚ï¼ŒåŒ…æ‹¬è·¯å¾„è®¡ç®—ã€äº‹ä»¶å“åº”ã€çŠ¶æ€å˜åŒ–ç­‰ã€‚è¿™ç§æ–¹å¼çµæ´»æ€§æœ€é«˜ï¼Œä½†å¤æ‚åº¦ä¹Ÿè¾ƒå¤§ã€‚è¿™é‡Œå¯ä»¥ç›´æ¥å‚è€ƒ [æºç ](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/edges/base-edge.ts) è¿›è¡Œå®ç°

## ä¸‰æ­¥åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰è¾¹

è®©æˆ‘ä»¬ä»æœ€åŸºç¡€çš„ `BaseEdge` å¼€å§‹ï¼Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰ç›´çº¿è¾¹ï¼š

```js | ob {pin:false}
(() => {
  const { Graph, register, BaseEdge, ExtensionCategory } = g6;

  class MyLineEdge extends BaseEdge {
    getKeyStyle(attributes) {
      return { ...super.getKeyStyle(attributes), lineWidth: 2, stroke: '#A4D3EE' };
    }

    getKeyPath(attributes) {
      const { sourceNode, targetNode } = this;
      const [x1, y1] = sourceNode.getPosition();
      const [x2, y2] = targetNode.getPosition();

      return [
        ['M', x1, y1],
        ['L', x2, y2],
      ];
    }
  }

  register(ExtensionCategory.EDGE, 'my-line-edge', MyLineEdge);

  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [
        { id: 'node1', style: { x: 100, y: 50 } },
        { id: 'node2', style: { x: 300, y: 120 } },
      ],
      edges: [{ source: 'node1', target: 'node2' }],
    },
    node: {
      style: {
        fill: '#7FFFD4',
        stroke: '#5CACEE',
        lineWidth: 2,
      },
    },
    edge: {
      type: 'my-line-edge',
      style: {
        zIndex: 3,
      },
    },
  });

  graph.render();

  return container;
})();
```

### ç¬¬ä¸€æ­¥ï¼šç¼–å†™è‡ªå®šä¹‰è¾¹ç±»

```typescript
import { BaseEdge } from '@antv/g6';
import type { BaseEdgeStyleProps } from '@antv/g6';

class MyLineEdge extends BaseEdge {
  // å®šä¹‰è¾¹çš„æ ·å¼ï¼Œå¯ä»¥æ·»åŠ æˆ–è¦†ç›–é»˜è®¤æ ·å¼
  protected getKeyStyle(attributes: Required<BaseEdgeStyleProps>) {
    // è°ƒç”¨çˆ¶ç±»æ–¹æ³•è·å–åŸºç¡€æ ·å¼ï¼Œç„¶åæ·»åŠ è‡ªå®šä¹‰æ ·å¼
    return { ...super.getKeyStyle(attributes), lineWidth: 2, stroke: '#A4D3EE' };
  }

  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šå®šä¹‰è¾¹çš„è·¯å¾„
  // è¿™æ˜¯ BaseEdge çš„æŠ½è±¡æ–¹æ³•ï¼Œæ‰€æœ‰å­ç±»å¿…é¡»å®ç°
  protected getKeyPath(attributes) {
    // è·å–æºèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹
    const { sourceNode, targetNode } = this;

    // è·å–èŠ‚ç‚¹çš„ä½ç½®åæ ‡
    const [x1, y1] = sourceNode.getPosition();
    const [x2, y2] = targetNode.getPosition();

    // è¿”å›SVGè·¯å¾„æ•°ç»„ï¼Œå®šä¹‰ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„ç›´çº¿
    return [
      ['M', x1, y1],
      ['L', x2, y2],
    ];
  }
}
```

:::success{title=å…³é”®æ–¹æ³•è§£æ}

- `getKeyStyle`: å®šä¹‰è¾¹çš„åŸºæœ¬æ ·å¼ï¼Œå¦‚çº¿å®½ã€é¢œè‰²ç­‰
- `getKeyPath`: æ˜¯ `BaseEdge` ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œ**å¿…é¡»å®ç°**ï¼Œå®ƒå®šä¹‰äº†è¾¹çš„è·¯å¾„å½¢çŠ¶
  :::

### ç¬¬äºŒæ­¥ï¼šæ³¨å†Œè‡ªå®šä¹‰è¾¹

ä½¿ç”¨ `register` æ–¹æ³•æ³¨å†Œè¾¹ç±»å‹ï¼Œè¿™æ · G6 æ‰èƒ½è¯†åˆ«ä½ çš„è‡ªå®šä¹‰è¾¹ï¼š

```js
import { ExtensionCategory } from '@antv/g6';

register(ExtensionCategory.EDGE, 'my-line-edge', MyLineEdge);
```

`register` æ–¹æ³•éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š

- æ‰©å±•ç±»åˆ«ï¼š`ExtensionCategory.EDGE` è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¾¹ç±»å‹
- ç±»å‹åç§°ï¼š`my-line-edge` æ˜¯æˆ‘ä»¬ç»™è¿™ä¸ªè‡ªå®šä¹‰è¾¹èµ·çš„åå­—ï¼Œåç»­ä¼šåœ¨é…ç½®ä¸­ä½¿ç”¨
- ç±»å®šä¹‰ï¼š`MyLineEdge` æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„è¾¹ç±»

### ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨è‡ªå®šä¹‰è¾¹

åœ¨å›¾çš„é…ç½®ä¸­ï¼Œé€šè¿‡è®¾ç½® `edge.type` æ¥ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰è¾¹ï¼š

```js
const graph = new Graph({
  container: 'container',
  data: {
    nodes: [
      { id: 'node1', style: { x: 100, y: 100 } },
      { id: 'node2', style: { x: 300, y: 150 } },
    ],
    edges: [{ source: 'node1', target: 'node2' }],
  },
  node: {
    style: {
      fill: '#7FFFD4',
      stroke: '#5CACEE',
      lineWidth: 2,
    },
  },
  edge: {
    type: 'my-line-edge',
    style: {
      zIndex: 3,
    },
  },
});

graph.render();
```

ğŸ‰ æ­å–œï¼ä½ å·²ç»åˆ›å»ºäº†ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰è¾¹ã€‚

## æ·±å…¥ç†è§£è‡ªå®šä¹‰è¾¹

### å¸¸ç”¨æ–¹æ³•

#### `upsert(name, Ctor, style, container, hooks)`

åœ¨åˆ›å»ºè‡ªå®šä¹‰è¾¹æ—¶ï¼Œä½ ä¼šé¢‘ç¹ç”¨åˆ° `upsert` æ–¹æ³•ã€‚å®ƒæ˜¯ "update or insert" çš„ç¼©å†™ï¼Œè´Ÿè´£æ·»åŠ æˆ–æ›´æ–°è¾¹ä¸­çš„å›¾å½¢å…ƒç´ ï¼š

```js | pure
// æ·»åŠ æˆ–æ›´æ–°ä¸€ä¸ªæ–‡æœ¬æ ‡ç­¾
this.upsert(
  'custom-label', // å…ƒç´ çš„å”¯ä¸€æ ‡è¯†
  'text', // å›¾å½¢ç±»å‹ï¼Œå¦‚ 'path', 'text', 'circle' ç­‰
  {
    // æ ·å¼é…ç½®å¯¹è±¡
    x: 100,
    y: 100,
    text: 'æ ‡ç­¾æ–‡æœ¬',
    fill: '#a975f3',
  },
  container, // çˆ¶å®¹å™¨
);
```

ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ `upsert` è€Œä¸ç›´æ¥é€šè¿‡ `container.appendChild()` åˆ›å»ºå›¾å½¢ï¼Ÿå› ä¸ºï¼š

1. **æ€§èƒ½æ›´å¥½**ï¼šå½“è¾¹çŠ¶æ€å˜åŒ–æˆ–æ•°æ®æ›´æ–°æ—¶ï¼Œä¼šæ™ºèƒ½åœ°å¤ç”¨å·²æœ‰å›¾å½¢ï¼Œè€Œä¸æ˜¯åˆ é™¤å†é‡å»ºï¼Œå¤§å¤§æé«˜äº†æ¸²æŸ“æ€§èƒ½
2. **ä»£ç æ›´ç®€æ´**ï¼šä¸éœ€è¦æ‰‹åŠ¨åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ âš ï¸ åŒºåˆ«äº v4
3. **ä¾¿äºç®¡ç†**ï¼šæ‰€æœ‰é€šè¿‡ `upsert` åˆ›å»ºçš„å›¾å½¢éƒ½ä¼šè¢«è®°å½•åœ¨è¾¹çš„ `shapeMap` ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `this.getShape(key)` è½»æ¾è·å–

<br/>

#### è·å–è¾¹çš„å…³é”®ä¿¡æ¯

```js
// è·å–è¾¹çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼ˆç®€å•æ¨¡å¼ - ä¸è€ƒè™‘èŠ‚ç‚¹å½¢çŠ¶ï¼Œç›´æ¥è¿”å›èŠ‚ç‚¹ä¸­å¿ƒç‚¹æˆ–æœ€è¿‘è¿æ¥æ¡©ä¸­å¿ƒËä½ç½®ï¼‰
const [sourcePoint, targetPoint] = this.getEndpoints(attributes, false);

// è·å–è¾¹çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼ˆä¼˜åŒ–æ¨¡å¼ - é»˜è®¤ä¸º trueï¼Œè€ƒè™‘èŠ‚ç‚¹å½¢çŠ¶ï¼Œè¿”å›èŠ‚ç‚¹è¾¹ç•Œä¸Šçš„è¿æ¥ç‚¹ï¼‰
const [sourcePoint, targetPoint] = this.getEndpoints(attributes);
```

<br/>

#### `getShape(name)`

é€šè¿‡æ­¤æ–¹æ³•å¯ä»¥è·å–ä¹‹å‰é€šè¿‡ `upsert` åˆ›å»ºçš„ä»»ä½•å›¾å½¢å…ƒç´ ï¼š

```js
// è·å–è¾¹çš„ä¸»ä½“å›¾å½¢
const keyShape = this.getShape('key');

// è·å–è‡ªå®šä¹‰æ ‡ç­¾
const labelShape = this.getShape('custom-label');

// æ£€æŸ¥å›¾å½¢æ˜¯å¦å­˜åœ¨ï¼Œç„¶åä¿®æ”¹å…¶å±æ€§
const badge = this.getShape('badge');
if (badge) {
  badge.attr('fill', '#ff0000');
}
```

:::info{title=å›¾å½¢é¡ºåº}
å›¾å½¢çš„åˆ›å»ºé¡ºåºå¾ˆé‡è¦ã€‚å¦‚æœå›¾å½¢ B ä¾èµ–å›¾å½¢ A çš„ä½ç½®ï¼Œå¿…é¡»ç¡®ä¿ A å…ˆåˆ›å»ºã€‚åœ¨è¾¹çš„é»˜è®¤æ¸²æŸ“æµç¨‹ä¸­ï¼Œå·²ç»æŒ‰ç…§åˆç†çš„é¡ºåºå®‰æ’äº†å„éƒ¨åˆ†çš„ç»˜åˆ¶ã€‚
:::

## ä»ç®€å•åˆ°å¤æ‚

### è‡ªå®šä¹‰è·¯å¾„çš„æŠ˜çº¿è¾¹

```js | ob
(() => {
  const { Graph, register, BaseEdge, ExtensionCategory } = g6;

  class MyPolylineEdge extends BaseEdge {
    getKeyPath(attributes) {
      const [sourcePoint, targetPoint] = this.getEndpoints(attributes);

      return [
        ['M', sourcePoint[0], sourcePoint[1]],
        ['L', targetPoint[0] / 2 + (1 / 2) * sourcePoint[0], sourcePoint[1]],
        ['L', targetPoint[0] / 2 + (1 / 2) * sourcePoint[0], targetPoint[1]],
        ['L', targetPoint[0], targetPoint[1]],
      ];
    }
  }

  register(ExtensionCategory.EDGE, 'my-polyline-edge', MyPolylineEdge);

  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [
        { id: 'node-0', style: { x: 100, y: 50, ports: [{ key: 'right', placement: [1, 0.5] }] } },
        { id: 'node-1', style: { x: 250, y: 150, ports: [{ key: 'left', placement: [0, 0.5] }] } },
      ],
      edges: [{ source: 'node-0', target: 'node-1' }],
    },
    edge: {
      type: 'my-polyline-edge',
      style: {
        startArrow: true,
        endArrow: true,
        stroke: '#F6BD16',
      },
    },
    behaviors: ['drag-element'],
  });

  graph.render();

  return container;
})();
```

### é¢å¤–æ ‡ç­¾

```js | ob
(() => {
  const { Graph, Line, register, BaseEdge, ExtensionCategory, subStyleProps } = g6;

  class LabelEdge extends Line {
    render(attributes, container) {
      super.render(attributes);
      this.drawEndLabel(attributes, container, 'start');
      this.drawEndLabel(attributes, container, 'end');
    }

    drawEndLabel(attributes, container, type) {
      const key = type === 'start' ? 'startLabel' : 'endLabel';
      const [x, y] = this.getEndpoints(attributes)[type === 'start' ? 0 : 1];

      const fontStyle = {
        x,
        y,
        dx: type === 'start' ? 15 : -15,
        fontSize: 16,
        fill: 'gray',
        textBaseline: 'middle',
        textAlign: type,
      };
      const style = subStyleProps(attributes, key);
      const text = style.text;
      this.upsert(`label-${type}`, 'text', text ? { ...fontStyle, ...style } : false, container);
    }
  }

  register(ExtensionCategory.EDGE, 'extra-label-edge', LabelEdge);

  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [
        { id: 'node-0', style: { x: 100, y: 100 } },
        { id: 'node-1', style: { x: 300, y: 100 } },
      ],
      edges: [{ source: 'node-0', target: 'node-1' }],
    },
    edge: {
      type: 'extra-label-edge',
      style: {
        startArrow: true,
        endArrow: true,
        stroke: '#F6BD16',
        startLabelText: 'start',
        endLabelText: 'end',
      },
    },
    behaviors: ['drag-element'],
  });

  graph.render();

  return container;
})();
```
