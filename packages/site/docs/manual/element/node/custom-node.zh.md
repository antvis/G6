---
title: è‡ªå®šä¹‰èŠ‚ç‚¹
order: 3
---

G6 æä¾›äº†ä¸€ç³»åˆ— [å†…ç½®èŠ‚ç‚¹](/manual/element/node/build-in/base-node)ï¼ŒåŒ…å« [circleï¼ˆåœ†å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/circle)ã€[diamondï¼ˆè±å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/diamond)ã€[donutï¼ˆç”œç”œåœˆèŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/donut)ã€[ellipseï¼ˆæ¤­åœ†èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/ellipse)ã€[hexagonï¼ˆå…­è¾¹å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/hexagon)ã€[htmlï¼ˆHTMLèŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/html)ã€[imageï¼ˆå›¾ç‰‡èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/image)ã€[rectï¼ˆçŸ©å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/rect)ã€[starï¼ˆæ˜Ÿå½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/star) å’Œ [triangleï¼ˆä¸‰è§’å½¢èŠ‚ç‚¹ï¼‰](/manual/element/node/build-in/triangle)ã€‚è¿™äº›å†…ç½®èŠ‚ç‚¹èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†åŸºç¡€åœºæ™¯éœ€æ±‚ã€‚

ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™äº›åŸºç¡€èŠ‚ç‚¹æ— æ³•æ»¡è¶³çš„éœ€æ±‚ã€‚è¿™æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ã€‚åˆ«æ‹…å¿ƒï¼Œè¿™æ¯”ä½ æƒ³è±¡çš„è¦ç®€å•ï¼

## å¼€å§‹ä¹‹å‰ï¼šäº†è§£èŠ‚ç‚¹çš„åŸºæœ¬æ„æˆ

åœ¨ G6 ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„èŠ‚ç‚¹é€šå¸¸ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œå°±åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œè¿™äº›éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„èŠ‚ç‚¹ã€‚

<img width="200" src="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Ot4bSbBx97EAAAAAAAAAAAAADmJ7AQ/original" />

ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š

- `key` ï¼šèŠ‚ç‚¹çš„ä¸»å›¾å½¢ï¼Œå¦‚çŸ©å½¢ã€åœ†å½¢ç­‰åŸºæœ¬å½¢çŠ¶
- `label` ï¼šæ–‡æœ¬æ ‡ç­¾ï¼Œé€šå¸¸ç”¨äºå±•ç¤ºèŠ‚ç‚¹çš„åç§°æˆ–æè¿°
- `icon` ï¼šå›¾æ ‡ï¼Œå±•ç¤ºèŠ‚ç‚¹çš„ç±»å‹æˆ–çŠ¶æ€
- `badge` ï¼šå¾½æ ‡ï¼Œä½äºèŠ‚ç‚¹è§’è½çš„å°æ ‡è®°
- `halo` ï¼šèŠ‚ç‚¹ä¸»å›¾å½¢å‘¨å›´å±•ç¤ºçš„å…‰æ™•æ•ˆæœ
- `port` ï¼šè¿æ¥æ¡©ï¼Œè¾¹çº¿å¯ä»¥è¿æ¥çš„ç‚¹

## è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ–¹å¼ <Badge type="warning">é€‰æ‹©åˆé€‚çš„æ–¹å¼</Badge>

åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§é€”å¾„ï¼š

### 1. ç»§æ‰¿ç°æœ‰èŠ‚ç‚¹ç±»å‹ <Badge type="success">æ¨è</Badge>

è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥é€‰æ‹©ç»§æ‰¿ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š

- [`BaseNode`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/base-node.ts) - æœ€åŸºç¡€çš„èŠ‚ç‚¹ç±»ï¼Œæä¾›èŠ‚ç‚¹çš„æ ¸å¿ƒåŠŸèƒ½
- [`Circle`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/circle.ts) - åœ†å½¢èŠ‚ç‚¹
- [`Rect`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/rect.ts) - çŸ©å½¢èŠ‚ç‚¹
- [`Ellipse`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/ellipse.ts) - æ¤­åœ†èŠ‚ç‚¹
- [`Diamond`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/diamond.ts) - è±å½¢èŠ‚ç‚¹
- [`Triangle`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/triangle.ts) - ä¸‰è§’å½¢èŠ‚ç‚¹
- [`Star`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/star.ts) - æ˜Ÿå½¢èŠ‚ç‚¹
- [`Image`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/image.ts) - å›¾ç‰‡èŠ‚ç‚¹
- [`Donut`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/donut.ts) - ç”œç”œåœˆèŠ‚ç‚¹
- [`Hexagon`](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/hexagon.ts) - å…­è¾¹å½¢èŠ‚ç‚¹

**ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼ï¼Ÿ**

- ğŸ“Œ **ä»£ç é‡å°‘**ï¼šå¤ç”¨ç°æœ‰èŠ‚ç‚¹çš„å±æ€§å’Œæ–¹æ³•ï¼Œåªéœ€ä¸“æ³¨äºæ–°å¢åŠŸèƒ½
- ğŸ“Œ **å¼€å‘è¿…é€Ÿ**ï¼šé€‚åˆå¤§å¤šæ•°é¡¹ç›®éœ€æ±‚ï¼Œå¿«é€Ÿå®ç°ä¸šåŠ¡ç›®æ ‡
- ğŸ“Œ **æ˜“äºç»´æŠ¤**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œç»§æ‰¿å…³ç³»æ˜ç¡®

### 2. åŸºäº G å›¾å½¢ç³»ç»Ÿä»é›¶å¼€å‘ <Badge>é«˜çº§ç”¨æ³•</Badge>

å¦‚æœç°æœ‰èŠ‚ç‚¹ç±»å‹éƒ½ä¸æ»¡è¶³éœ€æ±‚ï¼Œä½ å¯ä»¥åŸºäº G çš„åº•å±‚å›¾å½¢ç³»ç»Ÿä»é›¶åˆ›å»ºèŠ‚ç‚¹ã€‚

**ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼ï¼Ÿ**

- ğŸ“Œ **æœ€å¤§è‡ªç”±åº¦**ï¼šå®Œå…¨æ§åˆ¶èŠ‚ç‚¹çš„æ¯ä¸ªç»†èŠ‚ï¼Œå®ç°ä»»æ„å¤æ‚æ•ˆæœ
- ğŸ“Œ **ç‰¹æ®Šéœ€æ±‚**ï¼šç°æœ‰èŠ‚ç‚¹ç±»å‹æ— æ³•æ»¡è¶³çš„é«˜åº¦å®šåˆ¶åœºæ™¯
- ğŸ“Œ **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹ç‰¹å®šåœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–

:::warning{title=æ³¨æ„äº‹é¡¹}
ä»é›¶å¼€å‘çš„è‡ªå®šä¹‰èŠ‚ç‚¹éœ€è¦è‡ªè¡Œå¤„ç†æ‰€æœ‰ç»†èŠ‚ï¼ŒåŒ…æ‹¬å›¾å½¢ç»˜åˆ¶ã€äº‹ä»¶å“åº”ã€çŠ¶æ€å˜åŒ–ç­‰ï¼Œå¼€å‘éš¾åº¦è¾ƒå¤§ã€‚è¿™é‡Œå¯ä»¥ç›´æ¥å‚è€ƒ [æºç ](https://github.com/antvis/G6/blob/v5/packages/g6/src/elements/nodes/base-node.ts) è¿›è¡Œå®ç°ã€‚
:::

## ä¸‰æ­¥åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹

è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ - åˆ›å»ºä¸€ä¸ª **å¸¦æœ‰ä¸»å‰¯æ ‡é¢˜çš„çŸ©å½¢èŠ‚ç‚¹**ï¼š

```js | ob {pin:false}
(() => {
  const { Graph, register, Rect, ExtensionCategory } = g6;

  // ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ç±»
  class DualLabelNode extends Rect {
    // å‰¯æ ‡é¢˜æ ·å¼
    getSubtitleStyle(attributes) {
      return {
        x: 0,
        y: 45, // æ”¾åœ¨ä¸»æ ‡é¢˜ä¸‹æ–¹
        text: attributes.subtitle || '',
        fontSize: 12,
        fill: '#666',
        textAlign: 'center',
        textBaseline: 'middle',
      };
    }

    // ç»˜åˆ¶å‰¯æ ‡é¢˜
    drawSubtitleShape(attributes, container) {
      const subtitleStyle = this.getSubtitleStyle(attributes);
      this.upsert('subtitle', 'text', subtitleStyle, container);
    }

    // æ¸²æŸ“æ–¹æ³•
    render(attributes = this.parsedAttributes, container) {
      // 1. æ¸²æŸ“åŸºç¡€çŸ©å½¢å’Œä¸»æ ‡é¢˜
      super.render(attributes, container);

      // 2. æ·»åŠ å‰¯æ ‡é¢˜
      this.drawSubtitleShape(attributes, container);
    }
  }

  // ç¬¬äºŒæ­¥ï¼šæ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹
  register(ExtensionCategory.NODE, 'dual-label-node', DualLabelNode);

  // ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹
  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [
        {
          id: 'node1',
          style: { x: 100, y: 100 },
          data: {
            title: 'èŠ‚ç‚¹ A', // ä¸»æ ‡é¢˜
            subtitle: 'ä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹', // å‰¯æ ‡é¢˜
          },
        },
      ],
    },
    node: {
      type: 'dual-label-node',
      style: {
        fill: '#7FFFD4',
        stroke: '#5CACEE',
        lineWidth: 2,
        radius: 5,
        // ä¸»æ ‡é¢˜æ ·å¼
        labelText: (d) => d.data.title,
        labelFill: '#222',
        labelFontSize: 14,
        labelFontWeight: 500,
        // å‰¯æ ‡é¢˜
        subtitle: (d) => d.data.subtitle,
      },
    },
  });

  graph.render();

  return container;
})();
```

### ç¬¬ä¸€æ­¥ï¼šç¼–å†™è‡ªå®šä¹‰èŠ‚ç‚¹ç±»

ç»§æ‰¿ G6 çš„ `Rect`ï¼ˆçŸ©å½¢èŠ‚ç‚¹ï¼‰ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªå‰¯æ ‡é¢˜ï¼š

```js
import { Rect, register, Graph, ExtensionCategory } from '@antv/g6';

// åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œç»§æ‰¿è‡ª Rect
class DualLabelNode extends Rect {
  // å‰¯æ ‡é¢˜æ ·å¼
  getSubtitleStyle(attributes) {
    return {
      x: 0,
      y: 45, // æ”¾åœ¨ä¸»æ ‡é¢˜ä¸‹æ–¹
      text: attributes.subtitle || '',
      fontSize: 12,
      fill: '#666',
      textAlign: 'center',
      textBaseline: 'middle',
    };
  }

  // ç»˜åˆ¶å‰¯æ ‡é¢˜
  drawSubtitleShape(attributes, container) {
    const subtitleStyle = this.getSubtitleStyle(attributes);
    this.upsert('subtitle', 'text', subtitleStyle, container);
  }

  // æ¸²æŸ“æ–¹æ³•
  render(attributes = this.parsedAttributes, container) {
    // 1. æ¸²æŸ“åŸºç¡€çŸ©å½¢å’Œä¸»æ ‡é¢˜
    super.render(attributes, container);

    // 2. æ·»åŠ å‰¯æ ‡é¢˜
    this.drawSubtitleShape(attributes, container);
  }
}
```

### ç¬¬äºŒæ­¥ï¼šæ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹

ä½¿ç”¨ `register` æ–¹æ³•æ³¨å†ŒèŠ‚ç‚¹ç±»å‹ï¼Œè¿™æ · G6 æ‰èƒ½è¯†åˆ«ä½ çš„è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```js
register(ExtensionCategory.NODE, 'dual-label-node', DualLabelNode);
```

`register` æ–¹æ³•éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š

- æ‰©å±•ç±»åˆ«ï¼š`ExtensionCategory.NODE` è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹
- ç±»å‹åç§°ï¼š`dual-label-node` æ˜¯æˆ‘ä»¬ç»™è¿™ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹èµ·çš„åå­—ï¼Œåç»­ä¼šåœ¨é…ç½®ä¸­ä½¿ç”¨
- ç±»å®šä¹‰ï¼š`DualLabelNode` æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„èŠ‚ç‚¹ç±»

### ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹

åœ¨å›¾é…ç½®ä¸­ä½¿ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```js
const graph = new Graph({
  data: {
    nodes: [
      {
        id: 'node1',
        style: { x: 100, y: 100 },
        data: {
          title: 'èŠ‚ç‚¹ A', // ä¸»æ ‡é¢˜
          subtitle: 'ä½ çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹', // å‰¯æ ‡é¢˜
        },
      },
    ],
  },
  node: {
    type: 'dual-label-node',
    style: {
      fill: '#7FFFD4',
      stroke: '#5CACEE',
      lineWidth: 2,
      radius: 8,
      // ä¸»æ ‡é¢˜æ ·å¼
      labelText: (d) => d.data.title,
      labelFill: '#222',
      labelFontSize: 14,
      labelFontWeight: 500,
      // å‰¯æ ‡é¢˜
      subtitle: (d) => d.data.subtitle,
    },
  },
});

graph.render();
```

ğŸ‰ æ­å–œï¼ä½ å·²ç»åˆ›å»ºäº†ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹ã€‚å®ƒçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹åŒ…å«äº†è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ ¸å¿ƒæ€æƒ³ï¼š**ç»§æ‰¿ä¸€ä¸ªåŸºç¡€èŠ‚ç‚¹ç±»å‹**ï¼Œç„¶å **é‡å†™ `render` æ–¹æ³•** æ¥æ·»åŠ è‡ªå®šä¹‰å†…å®¹ã€‚

## æ›´è¿›ä¸€æ­¥ï¼šç†è§£èŠ‚ç‚¹ç»˜åˆ¶çš„åŸç†

åœ¨ G6 ä¸­åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨ Canvas ä¸Šç»˜åˆ¶å„ç§å›¾å½¢ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ç³»åˆ— "åŸå­å›¾å½¢" ä½œä¸ºåŸºç¡€æ„å»ºå—ï¼Œå°±åƒä¹é«˜ç§¯æœ¨ä¸­çš„ä¸åŒå½¢çŠ¶ã€‚

### åŸå­å›¾å½¢

G6 çš„èŠ‚ç‚¹æ˜¯ç”± [G å›¾å½¢ç³»ç»Ÿ](https://g.antv.antgroup.com/) æä¾›çš„å›¾å½¢åŸå­å•å…ƒç»˜åˆ¶è€Œæˆã€‚ä»¥ä¸‹æ˜¯å¸¸è§å›¾å½¢å…ƒç´ åŠå…¶ç”¨é€”ï¼š

| å›¾å½¢å…ƒç´  | ç±»å‹       | æè¿°                                                                                                                                                                        |
| -------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| åœ†å½¢     | `circle`   | é€‚åˆè¡¨ç¤ºçŠ¶æ€ã€å¤´åƒã€åœ†å½¢æŒ‰é’®ç­‰ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<circle\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Element/circle) å…ƒç´                                 |
| æ¤­åœ†     | `ellipse`  | ä¸ circle ç±»ä¼¼ï¼Œä½†æ”¯æŒæ¨ªçºµè½´ä¸åŒçš„åœºæ™¯ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<ellipse\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Element/ellipse) å…ƒç´                       |
| å›¾ç‰‡     | `image`    | ç”¨äºå±•ç¤ºå›¾æ ‡ã€ç”¨æˆ·å¤´åƒã€LOGO ç­‰ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<image\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/image) å…ƒç´                                            |
| ç›´çº¿     | `line`     | ç”¨äºè£…é¥°ã€è¾…åŠ©è¿æ¥ç­‰ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<line\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/line) å…ƒç´                                                         |
| è·¯å¾„     | `path`     | æ”¯æŒå¤æ‚å›¾å½¢ï¼Œå¦‚ç®­å¤´ã€åœ†å¼§ã€æ›²çº¿ã€è´å¡å°”è·¯å¾„ç­‰ã€‚è·¯å¾„ä¸­åŒ…å«ä¸€ç»„å‘½ä»¤ä¸å‚æ•°ï¼Œè¿™äº›å‘½ä»¤æœ‰ä¸åŒçš„è¯­ä¹‰ï¼Œ[å…·ä½“ç”¨æ³•](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths) |
| å¤šè¾¹å½¢   | `polygon`  | æ”¯æŒè‡ªå®šä¹‰å›¾å½¢ï¼Œå¦‚äº”è§’æ˜Ÿã€ç®­å¤´ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<polygon\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/polygon) å…ƒç´                                         |
| æŠ˜çº¿     | `polyline` | å¤šç‚¹æŠ˜çº¿ï¼Œé€‚åˆå¤æ‚çš„è¿çº¿ç»“æ„ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<polyline\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/polyline) å…ƒç´                                         |
| çŸ©å½¢     | `rect`     | æœ€å¸¸ç”¨å›¾å½¢ï¼Œé€‚åˆä½œä¸ºå®¹å™¨ã€å¡ç‰‡ã€æŒ‰é’®ç­‰åŸºç¡€ç»“æ„ã€‚å¯ä»¥å‚è€ƒ SVG çš„ [\<rect\>](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/rect) å…ƒç´                               |
| æ–‡æœ¬     | `text`     | æ˜¾ç¤ºåç§°ã€æè¿°ã€æ ‡ç­¾ç­‰å†…å®¹ã€‚æä¾›ç®€å•çš„å•è¡Œ/å¤šè¡Œæ–‡æœ¬æ’ç‰ˆèƒ½åŠ›ï¼Œå•è¡Œæ”¯æŒæ°´å¹³å¯¹é½ã€å­—ç¬¦é—´è·ï¼›å¤šè¡Œæ”¯æŒæ˜¾å¼æ¢è¡Œç¬¦ä»¥åŠè‡ªåŠ¨æ¢è¡Œï¼Œå‚ç›´å¯¹é½                                           |

> æ›´å¤šåŸå­å›¾å½¢å’Œè¯¦ç»†çš„å±æ€§è¯·å‚è€ƒ [å…ƒç´  - å›¾å½¢ï¼ˆå¯é€‰ï¼‰](/manual/element/shape/overview)

æ‰€æœ‰è¿™äº›å›¾å½¢éƒ½å¯é€šè¿‡ `upsert()` åŠ¨æ€åˆ›å»ºæˆ–æ›´æ–°ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†å›¾å½¢çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸã€‚

### å…ƒç´ åŸºç±»

å¼€å§‹è‡ªå®šä¹‰å…ƒç´ ä¹‹å‰ï¼Œä½ éœ€è¦äº†è§£ G6 å…ƒç´ åŸºç±»ä¸­çš„ä¸€äº›é‡è¦å±æ€§å’Œæ–¹æ³•ï¼š

#### å±æ€§

| å±æ€§       | ç±»å‹                          | æè¿°                       |
| ---------- | ----------------------------- | -------------------------- |
| shapeMap   | Record<string, DisplayObject> | å½“å‰å…ƒç´ ä¸‹æ‰€æœ‰å›¾å½¢çš„æ˜ å°„è¡¨ |
| animateMap | Record<string, IAnimation>    | å½“å‰å…ƒç´ ä¸‹æ‰€æœ‰åŠ¨ç”»çš„æ˜ å°„è¡¨ |

#### æ–¹æ³•

#### `upsert(name, Ctor, style, container, hooks)`: å›¾å½¢åˆ›å»º/æ›´æ–°

åœ¨åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ æ—¶ï¼Œä½ ä¼šé¢‘ç¹ç”¨åˆ° `upsert` æ–¹æ³•ã€‚å®ƒæ˜¯ "update or insert" çš„ç¼©å†™ï¼Œè´Ÿè´£æ·»åŠ æˆ–æ›´æ–°å…ƒç´ ä¸­çš„å›¾å½¢ï¼š

```typescript
upsert(key: string, Ctor: { new (...args: any[]): DisplayObject }, style: Record<string, any>, container: DisplayObject);
```

| å‚æ•°      | ç±»å‹                                    | æè¿°                                                                                                                                                                                                                                   |
| --------- | --------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| key       | string                                  | å›¾å½¢çš„ keyï¼Œå³ `shapeMap` ä¸­å¯¹åº”çš„ keyã€‚å†…ç½®çš„ key åŒ…æ‹¬ `'key'` `'label'` `'halo'` `'icon'` `'port'` `'badge'`<br/> key ä¸åº”ä½¿ç”¨ç‰¹æ®Šç¬¦å·ï¼Œä¼šåŸºäºè¯¥å€¼è½¬åŒ–ä¸ºé©¼å³°å½¢å¼è°ƒç”¨ `getXxxStyle` å’Œ `drawXxxShape` æ–¹æ³•ï¼ˆè§[å…ƒç´ çº¦å®š](#å…ƒç´ çº¦å®š)ï¼‰ |
| Ctor      | { new (...args: any[]): DisplayObject } | å›¾å½¢ç±»                                                                                                                                                                                                                                 |
| style     | Record<string, any>                     | å›¾å½¢æ ·å¼                                                                                                                                                                                                                               |
| container | DisplayObject                           | æŒ‚è½½å›¾å½¢çš„å®¹å™¨                                                                                                                                                                                                                         |

ä¾‹å¦‚ï¼Œæ’å…¥ä¸€ä¸ªå›ºå®šä½ç½®çš„ç´«è‰²åœ†å½¢ï¼š

```js
this.upsert(
  'element-key', // å…ƒç´ çš„å”¯ä¸€æ ‡è¯†
  'circle', // å›¾å½¢ç±»å‹ï¼Œå¦‚ 'rect', 'circle' ç­‰
  { x: 100, y: 100, fill: '#a975f3' }, // æ ·å¼é…ç½®å¯¹è±¡
  container, // çˆ¶å®¹å™¨
);
```

ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ `upsert` è€Œä¸ç›´æ¥é€šè¿‡ `container.appendChild()` åˆ›å»ºå›¾å½¢ï¼Ÿå› ä¸ºï¼š

1. **æ€§èƒ½æ›´å¥½**ï¼šå½“èŠ‚ç‚¹çŠ¶æ€å˜åŒ–æˆ–æ•°æ®æ›´æ–°æ—¶ï¼Œä¼šæ™ºèƒ½åœ°å¤ç”¨å·²æœ‰å›¾å½¢ï¼Œè€Œä¸æ˜¯åˆ é™¤å†é‡å»ºï¼Œå¤§å¤§æé«˜äº†æ¸²æŸ“æ€§èƒ½
2. **ä»£ç æ›´ç®€æ´**ï¼šä¸éœ€è¦æ‰‹åŠ¨åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨
3. **ä¾¿äºç®¡ç†**ï¼šæ‰€æœ‰é€šè¿‡ `upsert` åˆ›å»ºçš„å›¾å½¢éƒ½ä¼šè¢«è®°å½•åœ¨èŠ‚ç‚¹çš„ `shapeMap` ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `this.getShape(key)` è½»æ¾è·å–

#### `render(attributes, container)`: æ¸²æŸ“èŠ‚ç‚¹çš„ä¸»å…¥å£

æ¯ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹ç±»éƒ½å¿…é¡»å®ç° `render(attributes, container)` æ–¹æ³•ï¼Œå®ƒå®šä¹‰äº†è¯¥èŠ‚ç‚¹å¦‚ä½•è¢«â€œç»˜åˆ¶â€å‡ºæ¥ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨å„ç§åŸå­å›¾å½¢ï¼Œç»„åˆå‡ºä½ æƒ³è¦çš„ç»“æ„ã€‚

```typescript
render(style: Record<string, any>, container: Group): void;
```

| å‚æ•°      | ç±»å‹                | æè¿°     |
| --------- | ------------------- | -------- |
| style     | Record<string, any> | å…ƒç´ æ ·å¼ |
| container | Group               | å®¹å™¨     |

#### `getShape(name)`: è·å–å·²åˆ›å»ºçš„å›¾å½¢

æœ‰æ—¶ï¼Œä½ éœ€è¦åœ¨åˆ›å»ºåä¿®æ”¹æŸä¸ªå­å›¾å½¢çš„å±æ€§ï¼Œæˆ–è€…è®©å­å›¾å½¢ä¹‹é—´æœ‰äº¤äº’å…³è”ã€‚è¿™æ—¶ï¼Œ`getShape` æ–¹æ³•å¯ä»¥å¸®ä½ è·å–ä¹‹å‰é€šè¿‡ `upsert` åˆ›å»ºçš„ä»»ä½•å›¾å½¢ï¼š

**âš ï¸ æ³¨æ„**ï¼šå›¾å½¢çš„é¡ºåºå¾ˆé‡è¦ï¼Œå¦‚æœå›¾å½¢ B ä¾èµ–å›¾å½¢ A çš„ä½ç½®ï¼Œå¿…é¡»ç¡®ä¿ A å…ˆåˆ›å»º

### å…ƒç´ çº¦å®š

- **ä½¿ç”¨çº¦å®šå±æ€§**

ç›®å‰çº¦å®šçš„å…ƒç´ å±æ€§åŒ…æ‹¬ï¼š

- é€šè¿‡ `this.getSize()` è·å–å…ƒç´ çš„å°ºå¯¸

- **é‡‡ç”¨ `getXxxStyle` å’Œ `drawXxxShape` é…å¯¹çš„æ–¹å¼è¿›è¡Œå›¾å½¢ç»˜åˆ¶**

`getXxxStyle` ç”¨äºè·å–å›¾å½¢æ ·å¼ï¼Œ`drawXxxShape` ç”¨äºç»˜åˆ¶å›¾å½¢ã€‚é€šè¿‡è¯¥æ–¹å¼åˆ›å»ºçš„å›¾å½¢æ”¯æŒè‡ªåŠ¨æ‰§è¡ŒåŠ¨ç”»ã€‚

> å…¶ä¸­ `Xxx` æ˜¯è°ƒç”¨ [upsert](#æ–¹æ³•) æ–¹æ³•æ—¶ä¼ å…¥çš„ key çš„é©¼å³°å½¢å¼ã€‚

- **å¯é€šè¿‡ `this.context` è®¿é—® Graph ä¸Šä¸‹æ–‡**

### ç”Ÿå‘½å‘¨æœŸé’©å­

æä¾›äº†ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨è‡ªå®šä¹‰èŠ‚ç‚¹ä¸­é‡å†™è¿™äº›æ–¹æ³•ï¼Œåœ¨å…³é”®æ—¶åˆ»æ‰§è¡Œç‰¹å®šé€»è¾‘ï¼š

| é’©å­å‡½æ•°    | è§¦å‘æ—¶æœº                   | å…¸å‹ç”¨é€”                                     |
| ----------- | -------------------------- | -------------------------------------------- |
| `onCreate`  | å½“èŠ‚ç‚¹åˆ›å»ºåå®Œæˆå…¥åœºåŠ¨ç”»æ—¶ | ç»‘å®šäº¤äº’äº‹ä»¶ã€åˆå§‹åŒ–èŠ‚ç‚¹çŠ¶æ€ã€æ·»åŠ å¤–éƒ¨ç›‘å¬å™¨ |
| `onUpdate`  | å½“èŠ‚ç‚¹æ›´æ–°åå®Œæˆæ›´æ–°åŠ¨ç”»æ—¶ | æ›´æ–°ä¾èµ–æ•°æ®ã€è°ƒæ•´ç›¸å…³å…ƒç´ ã€è§¦å‘è”åŠ¨æ•ˆæœ     |
| `onDestroy` | å½“èŠ‚ç‚¹å®Œæˆé€€åœºåŠ¨ç”»å¹¶é”€æ¯å | æ¸…ç†èµ„æºã€ç§»é™¤å¤–éƒ¨ç›‘å¬å™¨ã€æ‰§è¡Œé”€æ¯é€šçŸ¥       |

### çŠ¶æ€å“åº”

G6 å…ƒç´ è®¾è®¡ä¸­æœ€å¼ºå¤§çš„ä¸€ç‚¹ï¼Œæ˜¯å¯ä»¥å°† **â€œçŠ¶æ€å“åº”â€** ä¸ **â€œç»˜åˆ¶é€»è¾‘â€** åˆ†ç¦»ã€‚

ä½ å¯ä»¥åœ¨èŠ‚ç‚¹é…ç½®ä¸­å®šä¹‰æ¯ç§çŠ¶æ€ä¸‹çš„æ ·å¼ï¼š

```js
node: {
  type: 'custom-node',
  style: { fill: '#fff' },
  state: {
    selected: {
      fill: '#f00',
    },
    hover: {
      lineWidth: 3,
      stroke: '#1890ff',
    },
  },
}
```

åˆ‡æ¢çŠ¶æ€çš„æ–¹æ³•:

```js
graph.setElementState(nodeId, ['selected']);
```

è¿™ä¸ªçŠ¶æ€ä¼šä¼ å…¥åˆ° `render()` æ–¹æ³•çš„ `attributes` ä¸­ï¼Œç”±å†…éƒ¨ç³»ç»Ÿåˆå¹¶åçš„ç»“æœè‡ªåŠ¨åº”ç”¨åœ¨å›¾å½¢ä¸Šã€‚

ä¹Ÿå¯ä»¥æ ¹æ®çŠ¶æ€è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ï¼š

```typescript
protected getKeyStyle(attributes: Required<BaseNodeStyleProps>) {
  const style = super.getKeyStyle(attributes);

  // æ ¹æ®çŠ¶æ€è°ƒæ•´æ ·å¼
  if (attributes.states?.includes('selected')) {
    return {
      ...style,
      stroke: '#1890ff',
      lineWidth: 2,
      shadowColor: 'rgba(24,144,255,0.2)',
      shadowBlur: 15,
    };
  }

  return style;
}
```

## ä»ç®€å•åˆ°å¤æ‚ï¼šé€æ­¥æ„å»ºåŠŸèƒ½ä¸°å¯Œçš„èŠ‚ç‚¹

è®©æˆ‘ä»¬é€šè¿‡å®é™…ä¾‹å­ï¼Œé€æ­¥å¢åŠ èŠ‚ç‚¹çš„å¤æ‚åº¦å’ŒåŠŸèƒ½ã€‚

### å¸¦å›¾æ ‡å’Œæ ‡ç­¾çš„èŠ‚ç‚¹

åœ¨èŠ‚ç‚¹å·¦ä¸Šè§’æ”¾ä¸€ä¸ªå›¾æ ‡å’Œæ ‡ç­¾æ–‡å­—ã€‚

> ğŸ‘‡ æ­¥éª¤è¯´æ˜ï¼š
>
> 1. ç»§æ‰¿ Rect èŠ‚ç‚¹
> 2. æ·»åŠ å›¾æ ‡ï¼ˆimageï¼‰
> 3. æ·»åŠ æ ‡ç­¾ï¼ˆtextï¼‰

```js | ob
(() => {
  const { Graph, register, Rect, ExtensionCategory } = g6;

  class IconNode extends Rect {
    get data() {
      return this.context.graph.getNodeData(this.id).data;
    }

    getCustomIconStyle(attributes) {
      const [width, height] = this.getSize(attributes);
      const { icon } = this.data;
      return {
        x: -width / 2 + 4, // å·¦ä¾§15pxå¤„
        y: -height / 2 + 4,
        width: 20,
        height: 20,
        src: icon,
      };
    }

    drawCustomIconShape(attributes, container) {
      const iconStyle = this.getCustomIconStyle(attributes);

      this.upsert('custom-icon', 'image', iconStyle, container);
    }

    getCustomLabelStyle(attributes) {
      const [width, height] = this.getSize(attributes);
      const { label } = this.data;
      return {
        x: -width / 2 + 26, // å›¾æ ‡å³ä¾§10pxå¤„
        y: -height / 2 + 14,
        text: label || '',
        fontSize: 10,
        fill: '#333',
        textAlign: 'left',
        textBaseline: 'middle',
      };
    }

    drawCustomLabelShape(attributes, container) {
      const labelStyle = this.getCustomLabelStyle(attributes);

      this.upsert('custom-label', 'text', labelStyle, container);
    }

    render(attributes, container) {
      // æ¸²æŸ“åŸºç¡€çŸ©å½¢
      super.render(attributes, container);

      // æ·»åŠ å›¾æ ‡
      this.drawCustomIconShape(attributes, container);

      // æ·»åŠ æ ‡ç­¾(åœ¨å›¾æ ‡å³ä¾§)
      this.drawCustomLabelShape(attributes, container);
    }
  }

  register(ExtensionCategory.NODE, 'custom-icon-node', IconNode);

  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [
        {
          id: 'node1',
          style: { x: 100, y: 100 },
          data: {
            icon: 'https://gw.alipayobjects.com/zos/antfincdn/FLrTNDvlna/antv.png',
            label: 'AntV',
          },
        },
      ],
    },
    node: {
      type: 'custom-icon-node',
      style: {
        size: [120, 60],
        fill: '#fff',
        stroke: '#873bf4',
        lineWidth: 2,
        radius: 2,
        labelText: 'G6',
        labelPlacement: 'middle',
        labelFontSize: 16,
        labelOffsetY: 6,
      },
    },
  });

  graph.render();

  return container;
})();
```

### å¯ç‚¹å‡»æŒ‰é’®çš„èŠ‚ç‚¹

ç»™èŠ‚ç‚¹åŠ ä¸€ä¸ªè“è‰²æŒ‰é’®ï¼Œç‚¹å‡»åè§¦å‘äº‹ä»¶ï¼ˆæ‰“å°æ—¥å¿—æˆ–æ‰§è¡Œå›è°ƒï¼‰ã€‚

```js | ob
(() => {
  const { Graph, register, Rect, ExtensionCategory } = g6;

  class ClickableNode extends Rect {
    getButtonStyle(attributes) {
      return {
        x: 40,
        y: -10,
        width: 20,
        height: 20,
        radius: 10,
        fill: '#1890ff',
        cursor: 'pointer', // é¼ æ ‡æŒ‡é’ˆå˜ä¸ºæ‰‹å‹
      };
    }

    drawButtonShape(attributes, container) {
      const btnStyle = this.getButtonStyle(attributes, container);
      const btn = this.upsert('button', 'rect', btnStyle, container);

      // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
      if (!btn.__clickBound) {
        btn.addEventListener('click', (e) => {
          // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘èŠ‚ç‚¹çš„ç‚¹å‡»äº‹ä»¶
          e.stopPropagation();

          // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
          console.log('Button clicked on node:', this.id);

          // å¦‚æœæ•°æ®ä¸­æœ‰å›è°ƒå‡½æ•°ï¼Œåˆ™è°ƒç”¨
          if (typeof attributes.onButtonClick === 'function') {
            attributes.onButtonClick(this.id, this.data);
          }
        });
        btn.__clickBound = true; // æ ‡è®°å·²ç»‘å®šäº‹ä»¶ï¼Œé¿å…é‡å¤ç»‘å®š
      }
    }

    render(attributes, container) {
      super.render(attributes, container);

      // æ·»åŠ ä¸€ä¸ªæŒ‰é’®
      this.drawButtonShape(attributes, container);
    }
  }

  register(ExtensionCategory.NODE, 'clickable-node', ClickableNode);

  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [
        {
          id: 'node1',
          style: { x: 100, y: 100 },
        },
      ],
    },
    node: {
      type: 'clickable-node', // æŒ‡å®šä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰èŠ‚ç‚¹
      style: {
        size: [60, 30],
        fill: '#7FFFD4',
        stroke: '#5CACEE',
        lineWidth: 2,
        radius: 5,
        onButtonClick: (id, data) => {},
      },
    },
  });

  graph.render();

  return container;
})();
```

### å“åº”çŠ¶æ€å˜åŒ–çš„èŠ‚ç‚¹ï¼ˆç‚¹å‡»å˜è‰²ï¼‰

å¸¸è§çš„äº¤äº’éƒ½éœ€è¦èŠ‚ç‚¹å’Œè¾¹é€šè¿‡æ ·å¼å˜åŒ–åšå‡ºåé¦ˆï¼Œä¾‹å¦‚é¼ æ ‡ç§»åŠ¨åˆ°èŠ‚ç‚¹ä¸Šã€ç‚¹å‡»é€‰ä¸­èŠ‚ç‚¹/è¾¹ã€é€šè¿‡äº¤äº’æ¿€æ´»è¾¹ä¸Šçš„äº¤äº’ç­‰ï¼Œéƒ½éœ€è¦æ”¹å˜èŠ‚ç‚¹å’Œè¾¹çš„æ ·å¼ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥å®ç°è¿™ç§æ•ˆæœï¼š

1. ä» `data.states` è·å–å½“å‰çŠ¶æ€ï¼Œåœ¨è‡ªå®šä¹‰èŠ‚ç‚¹ç±»ä¸­å¤„ç†çŠ¶æ€å˜åŒ–ï¼›
2. å°†äº¤äº’çŠ¶æ€åŒåŸå§‹æ•°æ®å’Œç»˜åˆ¶èŠ‚ç‚¹çš„é€»è¾‘åˆ†å¼€ï¼Œä»…æ›´æ–°èŠ‚ç‚¹ã€‚

æˆ‘ä»¬æ¨èç”¨æˆ·ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ¥å®ç°èŠ‚ç‚¹çš„çŠ¶æ€è°ƒæ•´ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®ç°ï¼š

1. å®ç°è‡ªå®šä¹‰èŠ‚ç‚¹ï¼›
2. åœ¨å›¾é…ç½®é¡¹ä¸­é…ç½®èŠ‚ç‚¹çŠ¶æ€æ ·å¼ï¼›
3. é€šè¿‡ `graph.setElementState()` æ–¹æ³•æ¥è®¾ç½®èŠ‚ç‚¹çŠ¶æ€ã€‚

åŸºäº rect æ‰©å±•å‡ºä¸€ä¸ª hole å›¾å½¢ï¼Œé»˜è®¤å¡«å……è‰²ä¸ºç™½è‰²ï¼Œå½“é¼ æ ‡ç‚¹å‡»æ—¶å˜æˆæ©™è‰²ï¼Œå®ç°è¿™ä¸€æ•ˆæœçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```js | ob
(() => {
  const { Rect, register, Graph, ExtensionCategory } = g6;

  // 1. å®šä¹‰èŠ‚ç‚¹ç±»
  class SelectableNode extends Rect {
    getHoleStyle(attributes) {
      return {
        x: 20,
        y: -10,
        radius: 10,
        width: 20,
        height: 20,
        fill: attributes.holeFill,
      };
    }

    drawHoleShape(attributes, container) {
      const holeStyle = this.getHoleStyle(attributes, container);

      this.upsert('hole', 'rect', holeStyle, container);
    }

    render(attributes, container) {
      super.render(attributes, container);

      this.drawHoleShape(attributes, container);
    }
  }

  // 2. æ³¨å†ŒèŠ‚ç‚¹
  register(ExtensionCategory.NODE, 'selectable-node', SelectableNode, true);

  // 3. åˆ›å»ºå›¾å®ä¾‹
  const container = createContainer({ height: 200 });

  const graph = new Graph({
    container,
    data: {
      nodes: [{ id: 'node-1', style: { x: 100, y: 100 } }],
    },
    node: {
      type: 'selectable-node',
      style: {
        size: [120, 60],
        radius: 6,
        fill: '#7FFFD4',
        stroke: '#5CACEE',
        lineWidth: 2,
        holeFill: '#fff',
      },
      state: {
        // é¼ æ ‡é€‰ä¸­çŠ¶æ€
        selected: {
          holeFill: 'orange',
        },
      },
    },
  });

  // 4. æ·»åŠ èŠ‚ç‚¹äº¤äº’
  graph.on('node:click', (evt) => {
    const nodeId = evt.target.id;

    graph.setElementState(nodeId, ['selected']);
  });

  graph.render();

  return container;
})();
```
